(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,r)=>{t.exports=e.r(76562)},44334,e=>{"use strict";e.s(["checkMe",()=>n,"doGet",()=>s,"doLogin",()=>i,"doPost",()=>a,"getCsrfToken",()=>o],44334);let t=()=>(e=>{if(!document||!document.cookie)return null;for(let t of document.cookie.split(";").map(e=>e.trim()))if(t.startsWith(e+"="))return decodeURIComponent(t.substring(e.length+1));return null})("XSRF-TOKEN"),r=async(e,r,a=null,s)=>{let i=t(),n=a?JSON.stringify(a):null;console.log(`Fetch initialized with url = ${e}, data = ${n}, method = ${r}`);let o={method:r,credentials:"include",headers:{"Content-Type":"application/json",...i&&{"X-XSRF-TOKEN":i}}};"POST"===r&&n&&(o.body=n);try{let t,a=await fetch(e,o);if(401===a.status)throw console.error("Authentication required - redirecting to login"),alert("ログインが必要です。ログインページにリダイレクトします。"),window.location.href="/login",Error("Authentication required");if(403===a.status)throw console.error("Access forbidden - insufficient permissions"),alert("アクセス権限がありません。"),Error("Access forbidden");if(!a.ok)throw Error(`Response Status: ${a.status}`);let s=a.headers.get("Content-Type")||"";if(204===a.status||""===s)return console.log(`Fetch finished with url = ${e}, method = ${r} (No Content)`),null;return t=s.includes("text/plain")?await a.text():s.includes("application/json")?await a.json():await a.text(),console.log(`Fetch finished with url = ${e}, fetchedData = ${JSON.stringify(t)}, method = ${r}`),t}catch(e){throw console.error(`Error: ${e}`),e instanceof Error&&!e.message.includes("Authentication")&&!e.message.includes("forbidden")&&alert(`エラー発生：必要であれば管理者に連絡してください。${e}`),s&&s(),e}};async function a(e,t){return await r(e,"POST",t)}async function s(e){return await r(e,"GET")}async function i(e,r){let a=t();console.log(`CSRF = ${a}`);let s=new URLSearchParams;s.append("username",e),s.append("password",r),s.append("_csrf",a),console.log(`Login initialized with username = ${e}`);try{let e=await fetch("/api/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",...a&&{"X-XSRF-TOKEN":a}},body:s.toString()});if(!e.ok)throw Error(`Response Status: ${e.status}`);let t=await e.json();return console.log(`Login finished, result = ${JSON.stringify(t)}`),t}catch(e){throw console.error(`Login Error: ${e}`),e}}async function n(){return await s("/api/me")}let o=async()=>await s("/api/csrf-token")},31134,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(18566),s=e.i(44334);let i=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},n=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:i="",children:l,iconNode:c,...d},u)=>(0,r.createElement)("svg",{ref:u,...o,width:t,height:t,stroke:e,strokeWidth:s?24*Number(a)/Number(t):a,className:n("lucide",i),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(l)?l:[l]])),c=(e,t)=>{let a=(0,r.forwardRef)(({className:a,...s},o)=>(0,r.createElement)(l,{ref:o,iconNode:t,className:n(`lucide-${i(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,a),...s}));return a.displayName=i(e),a},d=c("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),u=c("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);function h(){let[e,i]=(0,r.useState)(""),[n,o]=(0,r.useState)(""),[l,c]=(0,r.useState)(!1),[h,f]=(0,r.useState)(!1),p=(0,a.useRouter)(),m=(0,r.useCallback)(async e=>{p.push("student"===e?"/student-dashboard":"/teacher-dashboard")},[p]);(0,r.useEffect)(()=>{(async()=>{await (0,s.getCsrfToken)();let e=await (0,s.checkMe)();e.authenticated&&m(e.role)})()},[m]);let w=async t=>{t.preventDefault(),f(!0);let r=await (0,s.doLogin)(e,n);if(r.success){f(!1);let e=r.role;await (0,s.getCsrfToken)(),m(e)}else f(!1),alert(r.error||"ログインに失敗しました")};return(0,t.jsx)("div",{className:"container d-flex justify-content-center align-items-center vh-100",children:(0,t.jsx)("div",{className:"card mx-auto",style:{maxWidth:"400px"},children:(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h2",{className:"card-title",children:"ログイン"}),(0,t.jsxs)("form",{onSubmit:w,children:[(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"ログイン名またはメールアドレス"}),(0,t.jsx)("input",{type:"text",className:"form-control",value:e,onChange:e=>i(e.target.value),disabled:h,required:!0})]}),(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)("label",{className:"form-label",children:"パスワード"}),(0,t.jsxs)("div",{className:"input-group",children:[(0,t.jsx)("input",{type:l?"text":"password",className:"form-control",value:n,onChange:e=>o(e.target.value),disabled:h,required:!0}),(0,t.jsx)("span",{className:"input-group-text",style:{cursor:"pointer"},onClick:()=>c(!l),children:l?(0,t.jsx)(u,{size:18}):(0,t.jsx)(d,{size:18})})]})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary w-100",disabled:h,children:h?"ログイン中...":"ログイン"})]})]})})})}e.s(["default",()=>h],31134)}]);