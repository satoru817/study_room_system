# 自習室予約システム 講師用マニュアル

## 目次
1. [システム概要](#システム概要)
2. [ログインと初期画面](#ログインと初期画面)
3. [自習室の管理](#自習室の管理)
4. [スケジュール管理](#スケジュール管理)
5. [生徒管理](#生徒管理)
6. [予約システムの仕組み](#予約システムの仕組み)
7. [QRコードチェックインシステム](#qrコードチェックインシステム)
8. [よくある質問とトラブルシューティング](#よくある質問とトラブルシューティング)

---

## システム概要

### 本システムについて

自習室予約システムは、塾の自習室の予約・利用状況管理を効率化するためのWebアプリケーションです。講師は自習室のスケジュール管理や生徒の出席状況を簡単に把握でき、生徒は自分の都合に合わせて自習室を予約できます。

**主な機能:**
- 📅 ドラッグ&ドロップで簡単なスケジュール設定
- 🔄 スケジュール変更時の予約自動調整
- 📧 生徒への自動通知(メール・LINE)
- 📱 QRコードによる入退室管理
- 📊 学習時間の自動記録と可視化
- 👥 複数の自習室の一元管理

### システムの時間設定

- **営業時間範囲:** 午前7:00〜午後11:30
- **時間単位:** 15分刻み
- **予約可能期間:** 当日から未来の日付
- **座席数:** 自習室ごとに設定可能(デフォルト30席)

*※ スクリーンショット挿入位置: ダッシュボードのメイン画面*

---

## ログインと初期画面

### ログイン方法

1. ブラウザでシステムのURLにアクセスします
2. ログインページでログイン名とパスワードを入力します
3. 「ログイン」ボタンをクリックします

*※ スクリーンショット挿入位置: ログイン画面*

### 講師ダッシュボード

ログイン後、あなたが管理している塾の一覧が表示されます。塾を選択すると、その塾に所属する自習室の管理画面に移動します。

**表示される情報:**
- 塾名
- 所属する自習室の数
- 最終更新日時

*※ スクリーンショット挿入位置: 講師ダッシュボード(塾一覧)*

---

## 自習室の管理

### 自習室一覧画面

塾を選択すると、その塾の自習室一覧が表示されます。

**表示される情報:**
- 自習室名
- 定員数
- 現在の予約状況

**操作ボタン:**
- 🆕 **自習室を追加:** 新しい自習室を作成
- 🖨️ **QR印刷:** 座席のQRコードを印刷
- ✏️ **編集:** 自習室名や定員を変更
- 🗑️ **削除:** 自習室を削除
- ⚙️ **詳細設定:** スケジュール管理画面へ移動
- 👥 **生徒管理:** 生徒一覧画面へ移動

*※ スクリーンショット挿入位置: 自習室一覧画面*

### 自習室の新規作成

新しい自習室を作成する手順:

1. 自習室一覧画面で「自習室を追加」ボタンをクリック
2. 以下の情報を入力:
   - **自習室名:** 識別しやすい名前を入力(例: 「第1自習室」「静音室」)
   - **定員:** 最大収容人数を入力(デフォルト: 30人)
3. 「作成」ボタンをクリック

**注意事項:**
- 自習室名は同じ塾内でユニークである必要があります
- 定員は1人以上を設定してください
- 作成直後はスケジュールが設定されていないため、利用開始前にスケジュール設定が必要です

*※ スクリーンショット挿入位置: 自習室作成モーダル*

### 自習室の編集

既存の自習室の情報を変更する手順:

1. 編集したい自習室を選択
2. 「編集」ボタンをクリック
3. 自習室名または定員を変更
4. 「更新」ボタンをクリック

**重要な注意事項:**
- 定員を減らしても、既存の予約は自動的にキャンセルされません
- 定員を超える予約が存在する場合は、個別に調整が必要です

*※ スクリーンショット挿入位置: 自習室編集モーダル*

### 自習室の削除

⚠️ **重要:** 自習室を削除すると、以下のデータがすべて完全に削除されます:
- 通常スケジュール
- 例外スケジュール
- すべての予約
- すべての出席記録

**この操作は取り消せません。十分に注意してください。**

削除手順:
1. 削除したい自習室を選択
2. 「削除」ボタンをクリック
3. 確認ダイアログで「削除」を再度クリック

*※ スクリーンショット挿入位置: 削除確認ダイアログ*

### QRコードの印刷

各座席にQRコードを配置することで、生徒が簡単に入退室登録できます。

**QRコード印刷の手順:**

1. QRコードを印刷したい自習室を選択
2. 「QR印刷」ボタンをクリック
3. PDFファイルが自動生成されダウンロードされます
4. PDFを印刷します

**PDFの内容:**
- 座席番号ごとにQRコード生成(1番〜定員数)
- 1ページに12個のQRコード(3列×4行)
- 自習室名と座席番号が各QRコードに表示

**QRコードの設置方法:**
1. 印刷したQRコードを切り取ります
2. ラミネート加工をお勧めします(耐久性向上)
3. 各座席に座席番号に対応するQRコードを配置します
4. 生徒がスマートフォンでスキャンしやすい位置に設置してください

**ベストプラクティス:**
- QRコードは大きく鮮明に印刷してください
- ラミネート加工で保護することを推奨します
- 座席番号とQRコードの番号を一致させてください
- 設置後、実際にスキャンテストを行ってください

*※ スクリーンショット挿入位置: QRコードPDFのサンプル*

---

## スケジュール管理

スケジュール管理は本システムの中心機能です。「詳細設定」ボタンをクリックすると、スケジュール管理画面に移動します。

### スケジュール管理画面の構成

スケジュール管理画面には2つのセクションがあります:

1. **通常スケジュール:** 毎週繰り返される基本スケジュール
2. **例外スケジュール:** 特定の日付のみ適用される特別スケジュール

**スケジュールの優先順位:**
```
例外スケジュール > 通常スケジュール > 閉室
```

*※ スクリーンショット挿入位置: スケジュール管理画面全体*

---

## 通常スケジュール

### 通常スケジュールとは

通常スケジュールは、毎週繰り返される基本的な営業時間を定義します。

**特徴:**
- 曜日ごとに異なる時間帯を設定可能
- 一度設定すると、毎週自動的に適用される
- 例外スケジュールが設定されている日は、通常スケジュールは適用されない

### 通常スケジュールの設定方法

**画面の構成:**
- 横軸: 7列(月曜日〜日曜日)
- 縦軸: 66行(7:00〜23:30の15分刻み)
- 青色のセル: 開室時間
- 灰色のセル: 閉室時間

**操作方法(デスクトップ):**
1. 開室したい時間帯の開始セルをクリック
2. そのままドラッグして終了セルまで選択
3. 青色に変わったら開室時間として設定されます
4. 再度クリック&ドラッグで解除できます
5. すべての曜日の設定が完了したら「保存」ボタンをクリック

**操作方法(スマートフォン・タブレット):**
1. 開室したい時間帯の開始セルをタッチ
2. そのまま指をスライドして終了セルまで選択
3. 青色に変わったら開室時間として設定されます
4. 「保存」ボタンをクリック

**設定例:**
```
月曜日: 9:00〜21:00(青色に設定)
火曜日: 9:00〜21:00
水曜日: 9:00〜21:00
木曜日: 9:00〜21:00
金曜日: 9:00〜21:00
土曜日: 8:00〜18:00
日曜日: 閉室(灰色のまま)
```

*※ スクリーンショット挿入位置: 通常スケジュール設定画面*

### 通常スケジュール保存時の動作

「保存」ボタンをクリックすると、システムは以下の処理を行います:

**1. 影響を受ける予約の確認**

システムは新しいスケジュールによって影響を受ける予約を自動的に検出します:
- 新しいスケジュール外になる予約 → **削除対象**
- 新しいスケジュールと一部重なる予約 → **時間調整対象**

**2. 確認ダイアログの表示**

影響を受ける予約の詳細が表示されます:
- 削除される予約の一覧(生徒名、元の時間)
- 時間調整される予約の一覧(生徒名、変更前→変更後)

**3. 確認と実行**

「確定」をクリックすると:
- 予約が削除または調整されます
- 影響を受けたすべての生徒に通知が送信されます(メールまたはLINE)
- 通知結果が表示されます(成功数、失敗した生徒の名前)

**具体例:**
```
変更前の月曜日: 8:00〜20:00
変更後の月曜日: 9:00〜18:00

生徒Aの予約: 7:00〜10:00 → 9:00〜10:00に調整
生徒Bの予約: 10:00〜15:00 → 変更なし(範囲内)
生徒Cの予約: 17:00〜21:00 → 17:00〜18:00に調整
生徒Dの予約: 19:00〜22:00 → 削除(完全に範囲外)
```

*※ スクリーンショット挿入位置: 影響を受ける予約の確認ダイアログ*

### 通常スケジュールを他の自習室にコピー

複数の自習室に同じスケジュールを適用したい場合、コピー機能を使用できます。

**手順:**
1. コピー元の自習室のスケジュール管理画面を開く
2. 「他の自習室にコピー」ボタンをクリック
3. コピー先の自習室を選択(複数選択可能)
4. 「全て選択」ボタンで一括選択も可能
5. 「コピー」ボタンをクリック
6. 影響を受ける予約の確認ダイアログが表示される
7. 「確定」をクリック

**コピーされる内容:**
- コピー元の自習室の7曜日分の通常スケジュール

**影響:**
- コピー先の自習室の通常スケジュールは上書きされます
- コピー先の自習室の将来の予約が自動調整されます
- 影響を受けた生徒全員に通知が送信されます

**注意事項:**
- 例外スケジュールが設定されている日は影響を受けません
- 過去の予約は変更されません
- コピー先の自習室の定員が異なる場合、座席数の確認が必要です

*※ スクリーンショット挿入位置: スケジュールコピーモーダル*

---

## 例外スケジュール

### 例外スケジュールとは

例外スケジュールは、特定の日付のみ適用される特別なスケジュールです。祝日や特別講習期間など、通常と異なる営業時間を設定する場合に使用します。

**用途例:**
- 祝日の休業
- 定期試験期間の延長営業
- 設備メンテナンスによる臨時休業
- イベント開催による営業時間変更

**特徴:**
- 通常スケジュールより優先される
- 日付単位で個別に設定可能
- カレンダー表示で一覧確認が容易

*※ スクリーンショット挿入位置: 例外スケジュールのカレンダー表示*

### 例外スケジュールの表示

カレンダー形式で表示されます:
- **緑色の日付:** カスタムスケジュール(独自の営業時間)
- **赤色の日付:** 終日閉室
- **色なし:** 通常スケジュールを適用

**ナビゲーション:**
- 「前月」「次月」ボタンで月を移動
- 日付をクリックして詳細表示・編集

### 例外スケジュールの作成

**手順:**

1. カレンダーから設定したい日付をクリック
2. 例外スケジュール設定モーダルが開きます
3. 以下のいずれかを選択:

**オプション1: 終日閉室**
- 「閉鎖」ラジオボタンを選択
- 理由を入力(必須) 例: 「祝日のため休業」
- 「保存」ボタンをクリック

**オプション2: カスタムスケジュール**
- 「カスタムスケジュール」ラジオボタンを選択
- ドラッグ&ドロップで営業時間を設定
- 理由を入力(必須) 例: 「試験期間につき延長営業」
- 「保存」ボタンをクリック

**保存時の処理:**
- 設定した日付の既存予約が確認されます
- 新しいスケジュール外の予約は削除されます
- 一部重なる予約は時間調整されます
- 影響を受けた生徒に通知が送信されます

**理由の入力について:**
- 理由は必須項目です
- 生徒にも表示される可能性があるため、わかりやすく記入してください
- 例: 「祝日」「定期試験対応」「設備点検」「臨時休業」

*※ スクリーンショット挿入位置: 例外スケジュール設定モーダル*

### 例外スケジュールの編集

既存の例外スケジュールを変更する手順:

1. カレンダー上で例外が設定されている日付(緑または赤)をクリック
2. 現在の設定内容が表示されたモーダルが開く
3. スケジュールまたは理由を変更
4. 「保存」ボタンをクリック
5. 影響を受ける予約を確認
6. 「確定」をクリック

**変更例:**
```
変更前: カスタムスケジュール 8:00〜20:00
変更後: カスタムスケジュール 9:00〜22:00

→ 8:00〜9:00、20:00〜22:00の予約が影響を受ける
```

### 例外スケジュールの削除

例外スケジュールを削除すると、その日は通常スケジュールに戻ります。

**手順:**
1. 削除したい日付をクリック
2. モーダル内の「削除」ボタンをクリック
3. 確認ダイアログで「削除」を再度クリック

**削除時の動作:**
- 例外スケジュールが削除される
- その日は通常スケジュールに従うようになる
- 既存の予約が通常スケジュールに合わせて調整される
- 通常スケジュールでその曜日が閉室の場合、予約はすべて削除される
- 影響を受けた生徒に通知が送信される

**具体例:**
```
例外: 12/25(月) カスタムスケジュール 10:00〜22:00
通常: 月曜日 9:00〜18:00

削除後:
→ 12/25は9:00〜18:00に変更
→ 18:00〜22:00の予約はすべて削除または18:00までに調整
```

*※ スクリーンショット挿入位置: 例外スケジュール削除確認ダイアログ*

### 例外スケジュールを他の自習室にコピー

複数の自習室に同じ月の例外スケジュールを一括適用できます。

**手順:**
1. コピーしたい月をカレンダーで表示
2. 「例外スケジュールをコピー」ボタンをクリック
3. コピー先の自習室を選択(複数可)
4. 「コピー」ボタンをクリック
5. 影響を受ける予約を確認
6. 「確定」をクリック

**コピーされる内容:**
- 表示中の月のすべての例外スケジュール

**重要な注意事項:**
- コピー先の自習室の同じ月の例外スケジュールは上書きされます
- 他の月の例外スケジュールは影響を受けません
- コピー先の予約が自動調整されます
- 影響を受けたすべての生徒に通知が送信されます

**使用例:**
全ての自習室を12/29〜1/3の年末年始期間中閉室にする場合、1つの自習室で設定してから他の自習室にコピーすると効率的です。

*※ スクリーンショット挿入位置: 例外スケジュールコピーの通知結果*

---

## 生徒管理

生徒管理画面では、生徒の登録状況、予約状況、出席状況を一覧で確認できます。

### 生徒管理画面へのアクセス

自習室一覧画面から「生徒管理」ボタンをクリックします。

*※ スクリーンショット挿入位置: 生徒管理画面*

### 生徒一覧の表示内容

各生徒について以下の情報が表示されます:

**基本情報:**
- **名前:** 生徒の氏名
- **学年:** 自動計算(日本の学年制度に基づく)
- **メールアドレス:** 登録されているメールアドレス

**ステータス情報:**
- **登録状況:**
  - 登録済み: システムにログイン情報が登録されている
  - 未登録: まだシステムに登録していない
- **本日の予約:**
  - あり/なし
  - 予約がある場合は時間帯も表示
- **出席状況:**
  - 出席中: 現在自習室にいる
  - 未出席: 予約があるがまだ来室していない

**ステータスバッジ:**
- 🟢 **緑(出席中):** 現在自習室で学習中
- 🟡 **黄(未出席):** 本日の予約があるが未入室
- 🔴 **赤(要確認):** 入室すべき時間に未入室
- ⚫ **灰(未登録):** システム未登録
- ⚪ **白(予約なし):** 本日の予約なし

*※ スクリーンショット挿入位置: 生徒一覧とステータスバッジ*

### フィルタ機能

生徒を特定の条件で絞り込むことができます:

**フィルタボタン:**
- **全て:** すべての生徒を表示
- **出席中:** 現在自習室にいる生徒のみ
- **要確認:** 予約時間なのに未入室の生徒のみ
- **未登録:** システム未登録の生徒のみ

**ページネーション:**
- 1ページあたりの表示件数: 10、20、50、100件から選択可能
- 前後のページに移動可能

**使用例:**
毎日の出席確認時に「要確認」フィルタを使用して、連絡が必要な生徒を素早く特定できます。

*※ スクリーンショット挿入位置: フィルタ機能の使用例*

### 生徒の登録システム

本システムでは、セキュリティのためトークンベースの登録システムを採用しています。

**登録の流れ:**
1. 講師が生徒のメールアドレスを登録
2. 講師が登録リンクを送信
3. 生徒がリンクから登録ページにアクセス
4. 生徒がログイン名とパスワードを設定
5. 登録完了、ログイン可能になる

### メールアドレスの登録

生徒のメールアドレスを登録する方法:

**方法1: 個別登録**
1. 生徒の行をダブルクリック
2. メールアドレスを入力
3. 「登録」ボタンをクリック

**方法2: 一括登録**
通常、生徒データベースに直接メールアドレスを登録してから、一括で登録リンクを送信します。

*※ スクリーンショット挿入位置: メールアドレス登録モーダル*

### 登録リンクの送信

生徒に登録リンクを送信する手順:

**一括送信の手順:**
1. 「未登録」フィルタをクリックして未登録の生徒を表示
2. 登録リンクを送信したい生徒のチェックボックスをオン
3. または「全て選択」ボタンで一括選択
4. 「メール送信」ボタンをクリック
5. 確認ダイアログで「送信」をクリック
6. 送信結果が表示される:
   - 成功した送信数
   - 失敗した生徒の名前(もしあれば)

**送信される内容:**
- 件名: 「自習室予約システム登録のご案内」
- 本文: 登録手順と登録リンク
- リンクの有効期限: 14日間
- リンク形式: `https://yourdomain.com/register?token=一意のトークン`

**トークンのセキュリティ:**
- 各生徒に固有のトークンが生成される
- 有効期限は14日間
- 一度使用すると無効になる
- 新しいトークンを生成すると、古いトークンは無効になる

*※ スクリーンショット挿入位置: 登録リンク送信結果ダイアログ*

### 生徒側の登録手順

生徒が登録する際の流れ:

1. メールを受信し、登録リンクをクリック
2. 登録ページが開く
3. 以下の情報を入力:
   - **ログイン名:** システムログイン用(他の生徒と重複不可)
   - **パスワード:** 安全なパスワードを設定
   - **パスワード確認:** 同じパスワードを再入力
4. 「登録」ボタンをクリック
5. 登録完了のメッセージが表示される
6. 設定したログイン名とパスワードでログイン可能になる

**登録時の検証:**
- トークンの有効性(期限内、未使用)
- ログイン名の重複チェック
- パスワードの一致確認

**登録できない場合の対処:**
- トークンが期限切れ: 講師に新しいリンクの送信を依頼
- ログイン名が重複: 別のログイン名を試す
- リンクが無効: 講師に連絡

*※ スクリーンショット挿入位置: 生徒の登録画面*

### 生徒ダッシュボードの表示

講師は生徒の視点でシステムを確認できます。

**手順:**
1. 生徒一覧で確認したい生徒の行を探す
2. 右端のダッシュボードアイコン(📊)をクリック
3. 新しいタブで生徒のダッシュボードが開く

**生徒ダッシュボードで確認できる内容:**
- 本日の予約一覧
- QRスキャンボタンの状態
- 学習時間グラフ(週別)
- 予約作成ボタン

**用途:**
- 生徒から質問があった際の状況確認
- 予約方法の説明用デモンストレーション
- 生徒の学習履歴の確認

*※ スクリーンショット挿入位置: 生徒ダッシュボード*

---

## 予約システムの仕組み

### 時間枠システム

本システムは15分単位の固定時間枠を使用しています。

**時間枠の仕様:**
- 単位: 15分
- 範囲: 7:00〜23:30
- 総数: 1日あたり67枠
- 例: 7:00-7:15、7:15-7:30、7:30-7:45...

### 生徒による予約作成

生徒は以下の手順で予約を作成します:

**予約画面の機能:**
1. 週単位のカレンダー表示
2. 自習室の選択
3. 時間帯の選択(ドラッグ&ドロップ)
4. 予約の確定

**セルの色の意味:**
- 🔵 **青色:** 自分が選択中
- 🟢 **緑枠:** この自習室で既に予約済み
- 🟠 **オレンジ色:** 別の自習室で予約済み(重複予約不可)
- ⚪ **白色:** 予約可能
- 🔴 **赤色:** 満席
- ⚫ **灰色:** 閉室または過去の時間

**予約作成時の検証:**
- 自習室がその時間に開室しているか
- 座席に空きがあるか
- 他の自習室で同じ時間に予約していないか
- 過去の時間を予約していないか

**連続した時間枠の扱い:**
生徒が連続した15分枠を選択すると、システムは自動的に1つの予約にまとめます。

例:
```
選択: 9:00、9:15、9:30、9:45
→ 予約: 9:00-10:00(1件の予約として保存)
```

*※ スクリーンショット挿入位置: 生徒の予約作成画面*

### 座席数の管理

各時間枠ごとに空席数が計算されます。

**計算方法:**
```
空席数 = 自習室の定員 - その時間枠と重なる予約の数
```

**満席の判定:**
予約数が定員に達した時間枠は「満席」として表示され、新規予約ができなくなります。

**例:**
```
自習室A: 定員30人
9:00-9:15の予約数: 28件
→ 空席: 2席(あと2人予約可能)

9:00-9:15の予約数: 30件
→ 満席(新規予約不可)
```

### スケジュールの優先順位

システムは以下の優先順位でスケジュールを適用します:

```
1. 例外スケジュール(最優先)
   ↓ 存在しない場合
2. 通常スケジュール
   ↓ 存在しない場合
3. 閉室
```

**具体例:**
```
12/25(月):
- 例外スケジュール: 10:00-22:00が設定されている
- 通常スケジュール: 月曜日 9:00-18:00
→ 結果: 12/25は10:00-22:00で開室(例外が優先)

12/26(火):
- 例外スケジュール: なし
- 通常スケジュール: 火曜日 9:00-18:00
→ 結果: 12/26は9:00-18:00で開室

12/27(水):
- 例外スケジュール: なし
- 通常スケジュール: 水曜日 設定なし
→ 結果: 12/27は閉室
```

### 予約の自動調整

スケジュールが変更されると、システムは既存の予約を自動的に調整します。

**調整のアルゴリズム:**

1. **影響を受ける予約の特定**
   - 将来の予約のみ対象(本日以降)
   - 例外スケジュールがある日は除外

2. **予約の分類**
   - **削除対象:** 新しいスケジュール外
   - **調整対象:** 新しいスケジュールと一部重なる
   - **変更なし:** 新しいスケジュール内に完全に収まる

3. **時間の調整**
   ```
   元の予約: 8:00-12:00
   新スケジュール: 9:00-17:00
   調整後: 9:00-12:00(開始時刻を9:00に調整)
   ```

4. **調整内容の保存**

5. **生徒への通知**
   - 削除された予約: 削除通知
   - 調整された予約: 変更前と変更後の時刻を含む通知

**調整の具体例:**
```
通常スケジュール変更:
  変更前: 月曜日 8:00-20:00
  変更後: 月曜日 9:00-18:00

予約の調整:
  生徒A: 7:00-10:00  → 9:00-10:00に調整
  生徒B: 10:00-15:00 → 変更なし(範囲内)
  生徒C: 17:00-21:00 → 17:00-18:00に調整
  生徒D: 19:00-22:00 → 削除(完全に範囲外)
```

*※ スクリーンショット挿入位置: 予約調整の通知サンプル*

---

## QRコードチェックインシステム

### チェックインシステムの概要

生徒はQRコードをスキャンすることで、簡単に入退室を記録できます。保護者には自動的に入退室通知が送信されます。

**システムの利点:**
- 📱 スマートフォンで簡単操作
- ⏱️ 正確な入退室時刻の記録
- 📧 保護者への自動通知
- 📊 学習時間の自動計算

### 入室(チェックイン)の流れ

**生徒側の操作:**
1. 予約した自習室に到着
2. スマートフォンで生徒ダッシュボードを開く
3. QRスキャンボタンをタップ(緑色の場合のみ有効)
4. 座席のQRコードをスキャン
5. 「入室しました」のメッセージが表示される

**有効時間:**
- 予約開始時刻の5分前から
- 予約終了時刻の5分前まで

**システムの処理:**
1. QRコードから自習室IDと座席番号を取得
2. 正しい自習室かを確認
3. 有効な予約があるかを確認
4. 時間範囲内かを確認
5. 入室時刻を記録(データベースに保存)
6. 保護者にメール/LINE通知を送信

**保護者への通知内容:**
```
【入室通知】
お子様が自習室に入室しました。

生徒名: 山田太郎
自習室: 第1自習室
座席番号: 5番
入室時刻: 2024年12月25日 14:32
```

*※ スクリーンショット挿入位置: QRスキャン画面(入室)*

### 退室(チェックアウト)の流れ

**生徒側の操作:**
1. 学習を終える
2. スマートフォンで生徒ダッシュボードを開く
3. QRスキャンボタンをタップ(青色の場合のみ有効)
4. 座席のQRコードをスキャン
5. 「退室しました」のメッセージが表示される

**有効時間:**
- 入室後から
- 予約終了時刻の30分後まで

**システムの処理:**
1. QRコードを検証
2. 入室済みかを確認
3. 退室時刻を記録
4. 学習時間を計算(退室時刻 - 入室時刻)
5. 保護者にメール/LINE通知を送信

**保護者への通知内容:**
```
【退室通知】
お子様が自習室を退室しました。

生徒名: 山田太郎
自習室: 第1自習室
退室時刻: 2024年12月25日 17:15
学習時間: 2時間43分
```

*※ スクリーンショット挿入位置: QRスキャン画面(退室)*

### QRスキャンボタンの状態

生徒ダッシュボードのQRスキャンボタンは、状況に応じて色が変わります:

**🟢 緑色(入室可能):**
- 入室時間内
- まだ入室していない
- タップ可能

**🔵 青色(退室可能):**
- 既に入室済み
- 退室時間内
- タップ可能

**⚫ 灰色(無効):**
- 入室/退室の時間外
- 予約がない
- タップ不可

**時間範囲の例:**
```
予約: 14:00-17:00

入室可能時間: 13:55-16:55(緑色)
退室可能時間: 14:00以降〜17:30(青色)

13:54以前: ボタン灰色(早すぎる)
16:56-16:59: ボタン灰色(入室には遅すぎる)
17:31以降: ボタン灰色(退室には遅すぎる)
```

### 入退室の記録と学習時間

**記録される情報:**
- 生徒ID
- 予約ID
- 自習室ID
- 座席番号
- 入室時刻
- 退室時刻
- 学習時間(分)

**学習時間の計算:**
```
学習時間 = 退室時刻 - 入室時刻

例:
入室: 14:32
退室: 17:15
学習時間: 2時間43分 = 163分
```

**週別集計:**
システムは学習時間を週単位で集計し、グラフ表示します。週は月曜日始まり、日曜日終わりです。

*※ スクリーンショット挿入位置: 学習時間グラフ*

### チェックインの制約とルール

**基本ルール:**
1. 入室前にチェックアウトはできない
2. 1つの予約につき1回の入室・1回の退室のみ
3. 座席番号は記録されるが、座席の予約制ではない(どの席でもスキャン可能)
4. 予約がない時間帯はスキャンできない

**エラーケース:**

**1. 予約がない:**
```
「この時間帯の予約がありません」
→ 先に予約を作成してください
```

**2. 時間外:**
```
「まだ入室時間ではありません」
→ 予約開始5分前までお待ちください
```

**3. 既に入室済み:**
```
「既に入室済みです」
→ QRスキャンボタンが青色になっているか確認してください
```

**4. 自習室が違う:**
```
「別の自習室の予約です」
→ 予約した自習室のQRコードをスキャンしてください
```

### 講師による確認

講師は生徒管理画面で入退室状況を確認できます:

**リアルタイム確認:**
- 「出席中」フィルタで現在の在室者を表示
- 「要確認」フィルタで未入室の生徒を表示

**過去の記録:**
- データベースから出席記録を検索
- 学習時間の統計を確認

*※ スクリーンショット挿入位置: 出席状況一覧*

---

## 通知システム

### 通知の種類

本システムは以下の場面で自動通知を送信します:

**1. 登録リンク送信**
- 送信先: 生徒のメールアドレス
- 内容: システム登録用のリンク
- タイミング: 講師が「メール送信」ボタンを押したとき

**2. スケジュール変更による予約変更**
- 送信先: 影響を受けた生徒
- 内容: 予約の削除または時間変更の通知
- タイミング: スケジュール変更を保存したとき

**3. 入室通知**
- 送信先: 保護者(生徒に設定されたメール/LINE)
- 内容: 入室時刻と自習室情報
- タイミング: 生徒がQRコードで入室したとき

**4. 退室通知**
- 送信先: 保護者
- 内容: 退室時刻と学習時間
- タイミング: 生徒がQRコードで退室したとき

### 通知チャネル

システムは2つの通知方法をサポートしています:

**1. LINE通知(優先)**
- 即時配信
- 日本で広く使用されている
- 生徒にLINEユーザーIDが設定されている場合に使用

**2. メール通知(代替)**
- LINEが設定されていない場合に使用
- 標準的なメール形式
- 生徒にメールアドレスが設定されている必要がある

**通知方法の選択ロジック:**
```
if (生徒にLINE IDが設定されている) {
    LINE通知を送信
} else if (生徒にメールアドレスが設定されている) {
    メール通知を送信
} else {
    通知失敗として記録
}
```

### 通知の成功・失敗

スケジュール変更や登録リンク送信の際、通知結果がモーダルで表示されます:

**成功した場合:**
```
✓ 5人に通知を送信しました
```

**一部失敗した場合:**
```
⚠️ 3人に通知を送信しました
失敗: 山田太郎、佐藤花子
```

**失敗の主な原因:**
- メールアドレスもLINE IDも設定されていない
- メールアドレスが無効
- メールサーバーの問題
- LINE APIの問題

**失敗時の対応:**
1. 生徒の連絡先情報を確認
2. 手動で連絡
3. 必要に応じて連絡先を更新

*※ スクリーンショット挿入位置: 通知結果モーダル*

---

## よくある質問とトラブルシューティング

### 生徒の登録について

**Q1: 生徒が登録できないと言っています**

考えられる原因:
- トークンの期限切れ(14日経過)
- トークンが既に使用済み
- ログイン名が既に使用されている
- ネットワークの問題

対処法:
1. 新しい登録リンクを送信
2. ログイン名を変更してもらう
3. メールアドレスが正しいか確認

**Q2: 登録リンクのメールが届かない**

対処法:
1. 迷惑メールフォルダを確認してもらう
2. メールアドレスが正しいか確認
3. 再度メールを送信
4. 別のメールアドレスを試す

**Q3: 生徒のログイン情報を忘れた場合**

現在の対応:
- 講師権限でログイン情報をリセット
- または管理者に連絡

### 予約について

**Q4: 予約が表示されない**

確認事項:
1. 正しい自習室を選択しているか
2. 正しい日付を選択しているか
3. 最近スケジュール変更で削除されていないか
4. 生徒が正しくログインしているか

**Q5: 生徒が予約できないと言っている**

確認事項:
1. その時間帯に自習室が開室しているか
2. 満席になっていないか
3. 他の自習室で同じ時間に予約していないか
4. 過去の時間を予約しようとしていないか

対処法:
- 生徒ダッシュボード表示機能で状況を確認
- スケジュールを確認
- 必要に応じて定員を増やす

### チェックインについて

**Q6: QRスキャンボタンが押せない(灰色)**

原因:
1. 入室時間外(予約開始5分前より前)
2. 予約終了5分前を過ぎている
3. その時間の予約がない

対処法:
- 現在時刻と予約時間を確認
- 予約があるか確認
- 必要に応じて予約を作成

**Q7: QRコードをスキャンしてもエラーになる**

確認事項:
1. 予約している自習室のQRコードか
2. 有効な時間範囲内か
3. QRコードが破損していないか
4. カメラの権限が許可されているか

対処法:
- 正しい自習室のQRコードを使用
- 別の座席のQRコードを試す
- QRコードを再印刷

**Q8: 入室したのに退室ボタンが押せない**

原因:
- 入室記録が正しく保存されていない
- システムエラー

対処法:
1. ページを再読み込み
2. ログアウトして再ログイン
3. 管理者に連絡

### スケジュール管理について

**Q9: スケジュール変更が反映されない**

確認事項:
1. 「保存」ボタンをクリックしたか
2. 確認ダイアログで「確定」をクリックしたか
3. 例外スケジュールが設定されていないか

対処法:
- ブラウザを再読み込み(Ctrl+F5またはCmd+R)
- 例外スケジュールを確認
- 再度保存を試す

**Q10: 通常スケジュールを設定したのに生徒が予約できない**

確認事項:
- その日に例外スケジュール(閉室)が設定されていないか

対処法:
- カレンダーで例外スケジュールを確認
- 不要な例外スケジュールを削除

### 通知について

**Q11: 通知が送信されない**

確認事項:
1. 生徒にメールアドレスまたはLINE IDが設定されているか
2. 通知結果モーダルで失敗した生徒を確認

対処法:
- 生徒の連絡先情報を更新
- 手動で連絡
- 管理者にメールサーバーの状態を確認

**Q12: LINE通知とメール通知の違いは?**

- LINE通知: 即座に届く、日本で主流
- メール通知: LINEがない場合の代替手段

優先順位: LINE > メール

設定方法:
- 生徒データベースでLINE IDを設定
- 設定されていない場合はメールアドレスにフォールバック

### その他

**Q13: 自習室の定員を超える予約がある**

原因:
- 定員を減らした後に既存の予約が残っている
- システムエラー

対処法:
1. 超過している予約を個別に確認
2. 必要に応じて生徒に連絡して調整
3. または定員を元に戻す

**Q14: 誤って自習室を削除してしまった**

残念ながら:
- 削除は取り消せません
- すべてのデータが完全に削除されます

対処法:
1. データベースバックアップから復元(管理者に連絡)
2. 自習室を再作成してスケジュールを再設定
3. 生徒に予約の再作成を依頼

**Q15: システムの動作が遅い**

対処法:
1. ブラウザのキャッシュをクリア
2. 別のブラウザを試す
3. ネットワーク接続を確認
4. 管理者にサーバー状態を確認してもらう

---

## ベストプラクティス

### スケジュール管理のコツ

**1. 計画的な変更**
- スケジュール変更は少なくとも1日前に行う
- 急な変更は生徒に混乱を招く可能性がある

**2. 影響の確認**
- 変更前に必ず影響を受ける予約を確認
- 多数の予約が影響を受ける場合は慎重に判断

**3. コミュニケーション**
- システムが自動通知を送信するが、重要な変更は直接連絡も推奨
- 保護者への事前周知も検討

**4. 例外スケジュールの活用**
- 一時的な変更は例外スケジュールを使用
- 通常スケジュールは頻繁に変更しない

**5. 定期的な見直し**
- 月初に例外スケジュール(祝日など)を設定
- 季節ごとにスケジュールを見直す

### 生徒管理のコツ

**1. 一括操作の活用**
- 新学期開始時に一括で登録リンクを送信
- 効率的な運用が可能

**2. 連絡先の最新化**
- メールアドレスとLINE IDを常に最新に保つ
- 年度初めに確認を実施

**3. 未登録者のフォロー**
- 定期的に「未登録」フィルタで確認
- 未登録の生徒に個別フォローアップ

**4. 出席状況の監視**
- 「要確認」フィルタで毎日チェック
- 無断欠席の早期発見

**5. データのバックアップ**
- 定期的に生徒データをエクスポート
- 万が一に備える

### QRコード管理のコツ

**1. 耐久性の確保**
- ラミネート加工で保護
- 定期的に状態を確認

**2. 見やすい配置**
- スマートフォンでスキャンしやすい位置
- 照明に注意(反射を避ける)

**3. 座席番号の明確化**
- 物理的な座席番号とQRコードの番号を一致させる
- 座席レイアウト図の掲示

**4. テストの実施**
- 新しいQRコードは必ずテスト
- 生徒に使い方を説明

**5. 予備の準備**
- QRコードPDFのバックアップを保管
- 破損時の再印刷に備える

### 通知管理のコツ

**1. 結果の確認**
- 通知送信後は必ず結果を確認
- 失敗した生徒には手動で連絡

**2. LINEの推奨**
- 保護者にLINE通知の設定を推奨
- より確実で即時性が高い

**3. メールのバックアップ**
- すべての生徒にメールアドレスも設定
- LINEが使えない場合の保険

**4. 失敗時の対応**
- 通知失敗の記録を保管
- パターンを分析して改善

---

## まとめ

自習室予約システムは、塾の自習室管理を効率化し、生徒の学習環境を向上させるための強力なツールです。

**講師にとってのメリット:**
- 📊 直感的なドラッグ&ドロップ操作
- 🔄 予約の自動調整による手間の削減
- 📈 リアルタイムの出席状況把握
- 🎯 効率的な一括操作

**生徒にとってのメリット:**
- 📱 簡単な予約操作
- ⏱️ QRコードによる簡単入退室
- 📊 学習時間の可視化
- 📧 変更時の自動通知

**システムの知的機能:**
- スケジュール変更時の予約自動調整
- 生徒への影響を最小化
- 確実な通知配信
- 二重予約や定員超過の防止

本システムを活用することで、管理業務の負担を減らしながら、正確性と生徒満足度を維持できます。

**サポートが必要な場合:**
- システム管理者に連絡してください
- 本マニュアルを参照してトラブルシューティングを試してください
- より詳細な技術情報が必要な場合は、技術ドキュメントを参照してください

---

*※ 本マニュアルは2024年12月版です。システムのアップデートにより、画面や機能が変更される可能性があります。*

*※ スクリーンショットは適宜挿入してください。各セクションに「スクリーンショット挿入位置」を記載しています。*